# Configuration for Pattern Extraction from Cloud Resources
# This file defines patterns to extract various information from cloud resources

extractionPatterns:
  osType:
    ubuntu:
      name: "Ubuntu"
      versions: ["16.04", "18.04", "20.04", "22.04", "22.10", "23.10", "23.04", "24.04", "24.10", "25.04"]
      defaultVersion: ""
      patterns: ["ubuntu", "canonical"]
      
      # Rules for identifying basic OS images
      # Basic images are clean, official OS installations without additional software or customization
      basicImageRules:
        # Common rules applied to all CSPs by default
        # Designed to be CSP-agnostic using keyword-based patterns
        common:
          include:
            # Note: Pattern matching is case-insensitive
            # Keyword-based patterns (CSP-independent)
            - "*ubuntu*server*"      # Any image with "ubuntu" and "server" keywords
            - "*ubuntu*minimal*"     # Any image with "ubuntu" and "minimal" keywords
            - "*ubuntu*base*"        # Any image with "ubuntu" and "base" keywords
            - "*ubuntu*64bit*"       # 64-bit format without space (kt, alibaba, etc.)
            - "*ubuntu*lts*"         # LTS images with any separator (GCP format)
            - "ubuntu/images/*"      # Path-style naming (common in AWS)
            # Description-based patterns
            - "ubuntu server*"       # Images named/described as Ubuntu Server
            - "ubuntu * lts*"        # LTS version images
            - "ubuntu * 64 bit"      # 64-bit specification format
          exclude:
            # Note: Pattern matching is case-insensitive
            # Use specific patterns to avoid false positives
            # Commercial/Enterprise variants
            - "*ubuntu-pro*"         # Ubuntu Pro (paid support)
            - "*-pro-*"              # Pro variants with dashes
            - "*:pro-*"              # Azure format pro images
            - "*marketplace*"
            # Development/Testing  
            - "*daily*"
            - "*-dev-*"              # More specific than "*-dev*"
            # GPU/ML images
            - "*deep learning*"
            - "* gpu*"               # Images with GPU in name (space prefix)
            - "*-gpu*"               # Images with GPU suffix (e.g., ubuntu-22.04-gpu)
            - "*gpu driver*"         # GPU driver pre-installed
            - "*gpusvr*"             # KT GPU server images
            - "*nvidia*"             # NVIDIA-related images
            - "*cuda*"               # CUDA images
            - "*grid*"               # NVIDIA GRID vGPU driver (Tencent)
            # Custom kernel images
            - "*tk4*"                # Tencent Kernel 4.x (custom kernel)
            # Security/Compliance variants
            - "*-confidential-*"     # Confidential VM images (hyphen-delimited)
            - "*cvm:*"               # Confidential VM (Azure format)
            - "*fips*"
            # Kubernetes/Container optimized
            - "*-eks-*"              # EKS optimized
            - "*kubernetes*"
            - "*k8s*"
            - "* - container*"       # Container-optimized images (NHN)
            # Special purpose images
            - "* for nat*"           # NAT gateway images (NHN)
            # Pre-installed software (not basic OS)
            - "*sql*"                # Database pre-installed (MySQL, PostgreSQL, SQL Server)
            - "*mariadb*"            # MariaDB
            - "*redis*"              # Redis
            - "*kafka*"              # Apache Kafka
            - "*cubrid*"             # CUBRID
            - "* with *"             # "with X" pattern (NHN style - middleware pre-installed)
    centos:
      name: "CentOS"
      versions: ["7", "8", "9"]
      defaultVersion: ""
      patterns: ["centos", "centoscore"]
    debian:
      name: "Debian"
      versions: ["9", "10", "11", "12"]
      defaultVersion: ""
      patterns: ["debian"]
    windows:
      name: "Windows"
      versions: ["2016", "2019", "2022", "10", "11"]
      defaultVersion: ""
      patterns: ["windows", "win"]
    rhel:
      name: "Red Hat Enterprise Linux"
      versions: ["7", "8", "9"]
      defaultVersion: ""
      patterns: ["rhel", "red hat", "redhat"]
    amazonlinux:
      name: "Amazon Linux"
      versions: ["2", "2023"]
      defaultVersion: ""
      # Note: "amazon" pattern removed - too broad, matches AWS image metadata (ImageOwnerAlias: "amazon")
      # and causes Ubuntu/Windows images to be misclassified as Amazon Linux
      patterns: ["amazon linux", "amazon_linux", "amzn", "al20", "amazon-eks", "bottlerocket"]
    azurelinux:
      name: "Azure Linux"
      versions: ["2", "3"]
      defaultVersion: ""
      patterns: ["azurelinux", "azure linux"]
    fedora:
      name: "Fedora"
      versions: ["35", "36", "37", "38", "39"]
      defaultVersion: ""
      patterns: ["fedora"]
    suse:
      name: "SUSE Linux Enterprise Server"
      versions: ["12", "15"]
      defaultVersion: ""
      patterns: ["suse", "sles", "sles-sap"]
    rocky:
      name: "Rocky Linux"
      versions: ["8", "9"]
      defaultVersion: ""
      patterns: ["rocky"]
    oracle:
      name: "Oracle Linux"
      versions: ["7", "8", "9"]
      defaultVersion: "9"
      patterns: ["oracle"]
    alma:
      name: "AlmaLinux"
      versions: ["8", "9"]
      defaultVersion: ""
      patterns: ["alma"]
    alibaba:
      name: "Alibaba Cloud Linux"
      versions: ["2", "3"]
      defaultVersion: ""
      patterns: ["aliyun", "alibaba linux"]
    tencent:
      name: "Tencent Linux"
      versions: ["2", "3"]
      defaultVersion: ""
      patterns: ["tlinux", "tencentos"]
    
  # GPU image identification patterns (case-insensitive, any match = GPU)
  gpuPatterns:
    - "gpu"
    - "cuda"
    - "nvidia"
    - "deep learning"
    - "tensorflow"
    - "pytorch"
    - "keras"
    - "caffe"
    - "machine learning"
    - "optimized-for-ml"
  
  # Kubernetes image identification patterns (case-insensitive, any match = Kubernetes)
  k8sPatterns:
    # General terms
    - "kubernetes"
    - "k8s"
    # Removed "container" - too broad, causes false positives
    
    # CSP-specific terms
    - "eks"                # AWS Elastic Kubernetes Service
    - "amazon-eks"         # AWS EKS (full name in AMI)
    - "eks-optimized"      # AWS
    - "aks"                # Azure Kubernetes Service
    - "azurek8s"           # Azure
    - "gke"                # Google Kubernetes Engine
    - "cos-stable"         # GCP Container-Optimized OS (more specific than "cos")
    - "cos-cloud"          # GCP
    - "container-optimized" # GCP
    - "ack"                # Alibaba Cloud Container Service for Kubernetes
    - "aliyun-linux-k8s"   # Alibaba Cloud
    - "tke"                # Tencent Kubernetes Engine
    - "nks"                # NHN Cloud, NCP Kubernetes Service
    - "iks"                # IBM Kubernetes Service
    
    # K8s-dedicated/optimized OS distributions
    - "bottlerocket-aws-k8s"  # AWS Bottlerocket for Kubernetes (excludes ECS)
    - "flatcar"            # Flatcar Container Linux
    - "talos"              # Talos Linux (K8s-specific OS)
